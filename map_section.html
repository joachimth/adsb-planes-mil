<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
<script>
    console.log("ðŸ“Œ Initialiserer kort...");
    
    const map = L.map('map').setView([56.0, 10.0], 6); // Centreret over Danmark
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    function updateMap(flightData) {
        console.log("ðŸ“Œ Opdaterer kort...");

        // Fjern eksisterende markÃ¸rer
        map.eachLayer(layer => {
            if (layer instanceof L.Marker) {
                map.removeLayer(layer);
            }
        });

        // TilfÃ¸j nye markÃ¸rer
        flightData.forEach(flight => {
            if (flight.lat && flight.lon) {
                L.marker([flight.lat, flight.lon])
                    .addTo(map)
                    .bindPopup(`<b>${flight.callsign || 'Ukendt'}</b><br>HÃ¸jde: ${flight.alt_baro || 'N/A'} ft<br>Hastighed: ${flight.gs || 'N/A'} kn`);
            }
        });
    }

    // GÃ¸r funktionen global
    window.updateMap = updateMap;

    // Opdater kortet, hvis globalFlightData allerede er hentet
    if (globalFlightData && globalFlightData.length > 0) {
        updateMap(globalFlightData);
    }
</script>
